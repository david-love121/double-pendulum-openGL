# Data Model: Double Pendulum OpenGL Visualization

**Date**: September 6, 2025  
**Status**: Complete  

## Core Entities

### PendulumConfiguration
**Purpose**: Represents the physical parameters of a double pendulum system  
**Fields**:
- `l1: double` - Length of first pendulum arm (meters)
- `l2: double` - Length of second pendulum arm (meters)  
- `m1: double` - Mass of first pendulum bob (kg)
- `m2: double` - Mass of second pendulum bob (kg)
- `g: double` - Gravitational acceleration (m/s²)
- `damping: double` - Air resistance coefficient (optional)

**Validation Rules**:
- All lengths > 0.0
- All masses > 0.0
- g > 0.0
- damping >= 0.0

**Relationships**: Used by SimulationState for physics computation

### SimulationState
**Purpose**: Represents the instantaneous state of a double pendulum during simulation  
**Fields**:
- `theta1: double` - Angle of first pendulum from vertical (radians)
- `theta2: double` - Angle of second pendulum from vertical (radians)
- `omega1: double` - Angular velocity of first pendulum (rad/s)
- `omega2: double` - Angular velocity of second pendulum (rad/s)
- `timestamp: double` - Simulation time (seconds)
- `energy: double` - Total system energy (computed, cached)

**Validation Rules**:
- Angles normalized to [-π, π] range
- Energy conservation check (within tolerance)
- Timestamp monotonically increasing

**State Transitions**:
- `InitialState → RunningState`: Start simulation
- `RunningState → RunningState`: Physics integration step
- `RunningState → PausedState`: User pause
- `PausedState → RunningState`: User resume

**Relationships**: 
- Computed using PendulumConfiguration
- Cached in TrajectoryHistory for visualization

### ChaosAnalysisPoint
**Purpose**: Represents one point in the chaos analysis visualization  
**Fields**:
- `initial_theta1: double` - Initial angle of first pendulum
- `initial_theta2: double` - Initial angle of second pendulum
- `lyapunov_exponent: double` - Computed Lyapunov exponent (chaos measure)
- `color: RGB` - Visualization color based on chaos characteristics
- `computation_status: enum` - {PENDING, COMPUTING, COMPLETE, ERROR}

**Validation Rules**:
- Initial angles in valid range [-π, π]
- Lyapunov exponent finite (not NaN/Inf)
- Color values in [0, 255] range

**Relationships**: 
- Grouped in ChaosAnalysisGrid
- Color computed by ColorMapper

### ChaosAnalysisGrid
**Purpose**: Collection of analysis points forming the chaos visualization  
**Fields**:
- `resolution_x: int` - Number of grid points in theta1 direction
- `resolution_y: int` - Number of grid points in theta2 direction
- `theta1_min, theta1_max: double` - Range for first angle
- `theta2_min, theta2_max: double` - Range for second angle
- `points: vector<ChaosAnalysisPoint>` - Grid data (row-major order)
- `computation_progress: double` - Fraction complete [0.0, 1.0]

**Validation Rules**:
- Resolution values > 0
- Valid angle ranges (min < max)
- Points vector size = resolution_x * resolution_y

**Relationships**: 
- Contains array of ChaosAnalysisPoint
- Used by ChaosAnalyzer for parallel computation

### RenderingPrimitive
**Purpose**: Represents drawable elements in the OpenGL scene  
**Fields**:
- `type: enum` - {LINE, CIRCLE, ARC, TEXT}
- `position: vec2` - World space position
- `scale: vec2` - Size in world units
- `rotation: double` - Rotation angle (radians)
- `color: vec4` - RGBA color values [0.0, 1.0]
- `text_content: string` - For TEXT type only
- `vertex_data: vector<float>` - OpenGL vertex buffer data

**Validation Rules**:
- Color components in [0.0, 1.0] range
- Vertex data aligned to stride requirements

**Relationships**: 
- Generated by SimulationRenderer and AnalysisRenderer
- Consumed by OpenGL rendering pipeline

### ViewConfiguration
**Purpose**: Manages the two distinct application views  
**Fields**:
- `current_view: enum` - {SIMULATION, ANALYSIS}
- `simulation_config: SimulationViewConfig`
- `analysis_config: AnalysisViewConfig`
- `window_width, window_height: int` - Viewport dimensions

**SimulationViewConfig**:
- `camera_position: vec2` - Simulation camera center
- `zoom_level: double` - Rendering scale factor
- `show_labels: bool` - Display L1, L2, theta labels
- `show_trails: bool` - Show pendulum trajectory history

**AnalysisViewConfig**:
- `color_scheme: enum` - {BLUE_RED, VIRIDIS, PLASMA}
- `show_grid: bool` - Display coordinate grid
- `interactive_zoom: bool` - Allow mouse zoom/pan

**Validation Rules**:
- Window dimensions > 0
- Zoom level > 0.0
- Camera position within reasonable bounds

**Relationships**: 
- Controls rendering behavior in both views
- Modified by UI interactions

## Entity Relationships

```
PendulumConfiguration
    ↓ (configures)
SimulationState ←→ TrajectoryHistory
    ↓ (generates)
RenderingPrimitive
    ↓ (consumed by)
OpenGL Renderer

ChaosAnalysisGrid
    ↓ (contains)
ChaosAnalysisPoint[] ←→ ColorMapper
    ↓ (generates)
RenderingPrimitive
    ↓ (consumed by)
OpenGL Renderer

ViewConfiguration
    ↓ (controls)
SimulationRenderer | AnalysisRenderer
```

## Memory Layout Considerations

### GPU Memory (CUDA)
- `ChaosAnalysisPoint[]`: Stored in device memory for parallel computation
- Maximum grid size limited by GPU memory (typically 8-16GB)
- Structure padding aligned to 64-byte boundaries for coalesced access

### CPU Memory  
- `SimulationState`: Single instance, stack allocated
- `TrajectoryHistory`: Ring buffer, fixed size (last N seconds)
- `RenderingPrimitive[]`: Dynamic vector, pre-allocated capacity

### OpenGL Memory
- Vertex Buffer Objects (VBOs) for pendulum geometry
- Texture buffers for chaos analysis color data
- Shader uniform blocks for view matrices

## Serialization Format

**Configuration Files** (JSON):
```json
{
  "pendulum": {
    "l1": 1.0, "l2": 1.0,
    "m1": 1.0, "m2": 1.0,
    "g": 9.81
  },
  "simulation": {
    "timestep": 0.001,
    "integration_method": "RK4"
  },
  "analysis": {
    "grid_resolution": [256, 256],
    "angle_range": [[-3.14159, 3.14159], [-3.14159, 3.14159]]
  }
}
```

**Cache Files** (Binary):
- Little-endian format for cross-platform compatibility
- Magic header for file type validation
- Version field for backward compatibility
